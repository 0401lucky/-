# 老虎机规则扩展（v1 已落地）- 2026-01-23

> 目标：提升可玩性（更多组合、更稀有大爆、赌积分多下注档位），同时保持经济“平衡”（赌积分模式长期期望略亏，约 -10%）。
> 落地实现：后端判定 `src/lib/slot.ts`，常量表 `src/lib/slot-constants.ts`，前端规则弹窗/下注档位 `src/app/games/slot/page.tsx`，管理后台默认下注档位 `src/app/admin/settings/page.tsx`。

## 已确认（来自你本轮反馈）
- 二连：**任意两格相同都算**（不要求相邻/从左到右）
- “带符号加成”规则：二连 + 第三格是 **💎 或 7️⃣** 时，额外加分（“类似规则”）
  - ✅ `💎💎🍒`、`7️⃣7️⃣💎` 这类也算
  - ✅ **不叠加**（例如 `💎💎🍒` 只按“💎二连”结算，不再额外触发一次“带💎加成”）
- 风格：更稀有的大爆（不是高频小爆）
- 混合组合：选择 **💎💎+7️⃣**（任意顺序）
- 赌积分下注：预设档位即可（无需手动输入），且 **最大下注 ≤100**
  - 默认档位：`10 / 20 / 50 / 100`
- 规则展示：页面提供“规则/说明”按钮，点击弹窗展示本规则（用户可随时查看）

---

## 概率与随机性（当前实现口径）
老虎机每次旋转会对 3 个轴各抽 1 次符号，**每轴独立**，按“权重”随机（非等概率）。

当前默认权重（`src/lib/slot-constants.ts`）：
- 🍒 樱桃：30%
- 🍋 柠檬：24%
- 🍇 葡萄：20%
- ⭐ 星星：16%
- 💎 钻石：8%
- 7️⃣ 幸运7：2%

组合概率计算方式：
- 某个确定排列（例如 🍒🍋💎）的概率 = `0.30 * 0.24 * 0.08`
- “任意顺序”的概率 = 上式 * 可排列数（例如三种都不同就是 *6）

参考（基于上述权重）：
- 三 7️⃣（7️⃣7️⃣7️⃣）概率：`0.02^3 = 0.000008`（约 1/125000，非常稀有）
- 💎💎+7️⃣（任意顺序）概率：`3 * 0.08^2 * 0.02 = 0.000384`（约 1/2604，属于“偶尔大爆”）

---

## 判定顺序（只取一个最高规则，不叠加）
1. 三连（AAA）
2. 特殊爆：💎💎+7️⃣（任意顺序）
3. 二连 + 7️⃣（A A 7️⃣，且 A ≠ 7️⃣；不含 💎💎7️⃣）
4. 二连 + 💎（A A 💎，且 A ≠ 💎；可包含 7️⃣7️⃣💎）
5. 普通二连（A A B）
6. 其他：0

---

## 两种玩法模式

### A) 赚积分模式（免费转，受每日积分上限）
- 特点：产出积分，但会受到系统 `dailyPointsLimit` 限制（达到上限后继续旋转也不再发放）。
- 建议：用“更大的单次中奖”提升爽感，但总量仍由每日上限兜底。

### B) 赌积分模式（下注转，不受每日上限）
- 特点：用户下注扣积分，根据结果返还/盈利；整体设计成长期**期望略亏**（推荐约 -10%），用于平衡经济。
- 下注档位（默认）：`10 / 20 / 50 / 100`
- 结算口径：`净赢分 = 返奖 - 下注`
  - 返奖 = `下注 * 倍率`

---

## 数值设计（讨论稿 v0）
> 目标：你提到的“下注10赢20”这种“不是回本而是净赚”的体验，会体现在**稀有组合**上；
> 常见组合（尤其二连）以“回本/小赚”为主，大奖更稀有更爆。

### 赌积分模式：倍率表（下注 * 倍率）
> 说明：倍率设计为 0.1 步进，且下注档位都是 10 的倍数，确保返奖为整数积分。
> 该表在当前权重下估算“长期期望约 -10%”（house edge ≈ 10%）。

**1) 普通二连（A A B）倍率：按“二连符号”**
- 🍒🍒：x1.0（回本）
- 🍋🍋：x1.1
- 🍇🍇：x1.3
- ⭐⭐：x1.5
- 💎💎：x1.9
- 7️⃣7️⃣：x3.1

**2) 二连 + 💎（A A 💎，A≠💎）：在“普通二连倍率”基础上 +0.7**
- 例：🍒🍒💎 => x(1.0+0.7)=x1.7
- 例：7️⃣7️⃣💎 => x(3.1+0.7)=x3.8

**3) 二连 + 7️⃣（A A 7️⃣，A≠7️⃣，且不含💎💎7️⃣）：在“普通二连倍率”基础上 +2.2**
- 例：🍒🍒7️⃣ => x(1.0+2.2)=x3.2
- 例：💎💎7️⃣ 不走此条，见下一条“特殊爆”

**4) 特殊爆：💎💎+7️⃣（任意顺序）**
- 倍率：x20

**5) 三连（AAA）倍率：按“三连符号”**
- 🍒🍒🍒：x3
- 🍋🍋🍋：x4
- 🍇🍇🍇：x6
- ⭐⭐⭐：x10
- 💎💎💎：x20
- 7️⃣7️⃣7️⃣：x60（极稀有超级爆）

### 赚积分模式：建议用“固定基础值 * 倍率”复用同一张表
为减少维护成本，建议赚积分模式按同一倍率表计算，但用固定基础值：
- 设定 `earnBase = 20`（已确认）
- 发放积分 = `earnBase * 倍率`（再受 `dailyPointsLimit` 截断）

这样对应到具体点数（示例）：
- 🍒🍒：20
- 🍒🍒💎：34
- 🍒🍒7️⃣：64
- 💎💎7️⃣：400
- 7️⃣7️⃣7️⃣：1200

---

## UI 展示（待实现）
- 老虎机页新增「规则」按钮（建议放在“赔率表”卡片标题右侧或顶部导航旁）
- 点击弹出弹窗（Modal）展示：
  - 玩法模式说明（赚积分/赌积分）
  - 下注档位与结算口径（净赢分）
  - 组合判定顺序
  - 倍率表与几个“例子”（下注10/20的示例）
  - 公平性说明：按权重随机、独立抽取、后端判定

---

## 已确认的数值
- `earnBase = 20`
- “特殊爆 💎💎+7️⃣”倍率：`x20`
