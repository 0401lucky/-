// src/app/games/tower/lib/sprites.ts - 像素精灵定义

/**
 * 精灵定义：16×16 颜色索引矩阵
 * 0 = 透明, 1 = 主色, 2 = 轮廓/阴影, 3 = 高亮, 4 = 次要色
 */

export type SpriteData = number[][];

// 调色板映射 - 不同实体使用不同调色板
export interface Palette {
  0: string; // 透明
  1: string; // 主色
  2: string; // 轮廓
  3: string; // 高亮
  4: string; // 次要色
  [key: number]: string;
}

export const PLAYER_PALETTE: Palette = {
  0: 'transparent',
  1: '#4fc3f7', // 蓝色主体
  2: '#0288d1', // 深蓝轮廓
  3: '#e1f5fe', // 白色高亮
  4: '#ffeb3b', // 黄色细节（剑）
};

export const MONSTER_PALETTE: Palette = {
  0: 'transparent',
  1: '#ef5350', // 红色主体
  2: '#b71c1c', // 深红轮廓
  3: '#ffcdd2', // 浅红高亮
  4: '#ff8a65', // 橙色细节
};

export const ADD_PALETTE: Palette = {
  0: 'transparent',
  1: '#66bb6a', // 绿色主体
  2: '#2e7d32', // 深绿轮廓
  3: '#c8e6c9', // 浅绿高亮
  4: '#ffffff', // 白色 +
};

export const MULTIPLY_PALETTE: Palette = {
  0: 'transparent',
  1: '#ffa726', // 橙色主体
  2: '#e65100', // 深橙轮廓
  3: '#ffe0b2', // 浅橙高亮
  4: '#ffffff', // 白色 ×
};

// 像素小人精灵（16x16）
export const PLAYER_SPRITE: SpriteData = [
  [0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,0],
  [0,0,0,0,0,2,3,3,3,3,2,0,0,0,0,0],
  [0,0,0,0,2,1,3,1,1,3,1,2,0,0,0,0],
  [0,0,0,0,2,1,1,1,1,1,1,2,0,0,0,0],
  [0,0,0,0,0,2,1,2,2,1,2,0,0,0,0,0],
  [0,0,0,0,0,0,2,1,1,2,0,0,0,0,0,0],
  [0,0,0,0,0,2,1,1,1,1,2,0,0,0,0,0],
  [0,0,0,4,2,1,1,1,1,1,1,2,0,0,0,0],
  [0,0,0,4,2,1,1,1,1,1,1,2,0,0,0,0],
  [0,0,0,4,0,2,1,1,1,1,2,0,0,0,0,0],
  [0,0,0,0,0,2,1,1,1,1,2,0,0,0,0,0],
  [0,0,0,0,0,2,1,0,0,1,2,0,0,0,0,0],
  [0,0,0,0,0,2,1,0,0,1,2,0,0,0,0,0],
  [0,0,0,0,2,2,1,0,0,1,2,2,0,0,0,0],
  [0,0,0,0,2,1,1,0,0,1,1,2,0,0,0,0],
  [0,0,0,0,0,2,2,0,0,2,2,0,0,0,0,0],
];

// 怪物精灵（16x16）
export const MONSTER_SPRITE: SpriteData = [
  [0,0,0,0,2,2,2,2,2,2,2,2,0,0,0,0],
  [0,0,0,2,1,1,1,1,1,1,1,1,2,0,0,0],
  [0,0,2,1,1,1,1,1,1,1,1,1,1,2,0,0],
  [0,2,1,1,3,3,1,1,1,3,3,1,1,1,2,0],
  [0,2,1,1,3,2,1,1,1,3,2,1,1,1,2,0],
  [0,2,1,1,1,1,1,1,1,1,1,1,1,1,2,0],
  [0,2,1,1,1,1,2,2,2,1,1,1,1,1,2,0],
  [0,0,2,1,1,1,1,1,1,1,1,1,1,2,0,0],
  [0,0,2,4,1,1,1,1,1,1,1,1,4,2,0,0],
  [0,0,0,2,4,1,1,1,1,1,1,4,2,0,0,0],
  [0,0,0,2,1,1,1,1,1,1,1,1,2,0,0,0],
  [0,0,2,1,1,2,1,1,1,2,1,1,1,2,0,0],
  [0,0,2,1,2,0,2,1,2,0,2,1,1,2,0,0],
  [0,2,1,2,0,0,0,2,0,0,0,2,1,1,2,0],
  [0,2,2,0,0,0,0,0,0,0,0,0,2,2,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
];

// 加法增益精灵（16x16）
export const ADD_SPRITE: SpriteData = [
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,2,2,2,2,2,2,2,2,0,0,0,0],
  [0,0,0,2,1,1,1,1,1,1,1,1,2,0,0,0],
  [0,0,2,1,1,1,1,1,1,1,1,1,1,2,0,0],
  [0,2,1,1,1,1,1,4,1,1,1,1,1,1,2,0],
  [0,2,1,1,1,1,1,4,1,1,1,1,1,1,2,0],
  [0,2,1,1,1,1,1,4,1,1,1,1,1,1,2,0],
  [0,2,1,4,4,4,4,4,4,4,4,4,1,1,2,0],
  [0,2,1,1,1,1,1,4,1,1,1,1,1,1,2,0],
  [0,2,1,1,1,1,1,4,1,1,1,1,1,1,2,0],
  [0,2,1,1,1,1,1,4,1,1,1,1,1,1,2,0],
  [0,0,2,1,1,1,1,1,1,1,1,1,1,2,0,0],
  [0,0,0,2,1,1,1,1,1,1,1,1,2,0,0,0],
  [0,0,0,0,2,2,2,2,2,2,2,2,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
];

// 乘法增益精灵（16x16）
export const MULTIPLY_SPRITE: SpriteData = [
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,2,2,2,2,2,2,2,2,0,0,0,0],
  [0,0,0,2,1,1,1,1,1,1,1,1,2,0,0,0],
  [0,0,2,1,1,1,1,1,1,1,1,1,1,2,0,0],
  [0,2,1,1,4,1,1,1,1,1,4,1,1,1,2,0],
  [0,2,1,1,1,4,1,1,1,4,1,1,1,1,2,0],
  [0,2,1,1,1,1,4,1,4,1,1,1,1,1,2,0],
  [0,2,1,1,1,1,1,4,1,1,1,1,1,1,2,0],
  [0,2,1,1,1,1,4,1,4,1,1,1,1,1,2,0],
  [0,2,1,1,1,4,1,1,1,4,1,1,1,1,2,0],
  [0,2,1,1,4,1,1,1,1,1,4,1,1,1,2,0],
  [0,0,2,1,1,1,1,1,1,1,1,1,1,2,0,0],
  [0,0,0,2,1,1,1,1,1,1,1,1,2,0,0,0],
  [0,0,0,0,2,2,2,2,2,2,2,2,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
];

/**
 * 在 canvas 上绘制像素精灵
 */
export function drawSprite(
  ctx: CanvasRenderingContext2D,
  sprite: SpriteData,
  palette: Palette,
  x: number,
  y: number,
  scale: number = 3
) {
  for (let row = 0; row < sprite.length; row++) {
    for (let col = 0; col < sprite[row].length; col++) {
      const colorIndex = sprite[row][col];
      if (colorIndex === 0) continue; // 透明
      ctx.fillStyle = palette[colorIndex] || 'magenta';
      ctx.fillRect(x + col * scale, y + row * scale, scale, scale);
    }
  }
}
